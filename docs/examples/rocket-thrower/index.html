<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>The Rocket Thrower - Wizards of Lua by </title>
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="stylesheet" href="/css/extra.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="/assets/js/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/assets/css/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>
      
      <div id="header">
        <nav>
          <!-- <li class="fork"><a href="">View On GitHub</a></li> -->
          <li class="fork"><a href="https://github.com/wizards-of-lua/wizards-of-lua">View On GitHub</a></li>

          
            <li class="translate">
              <a href="http://translate.google.com/translate?hl=&sl=auto&tl=de&u=http%3A%2F%2Fwww.wizards-of-lua.net/examples/rocket-thrower/" alt="Translate this page"></a>
            </li>
          
          <li class="discord"><a href="https://discord.gg/9En5Drt" alt="Discord"></a></li>
          <li class="twitter"><a href="https://twitter.com/WizardsOfLua?ref_src=twsrc%5Etfw" alt="Follow @WizardsOfLua"></a></li>
          
          
        </nav>
      </div><!-- end header -->
      
    <div class="wrapper">

      <section>
        <div id="title">
          <img src="/images/steven-with-magic-wand-glowing.png" height="170" />
          <h1><a href="/">Wizards of Lua</a></h1>
          <p>The Art of Spell Crafting</p>
          <hr>
          <!--
          <span class="credits left">Project maintained by <a href=""></a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
          -->
        </div>

        <h1>The Rocket Thrower</h1>
        <p>Imagine you want to have a magic wand that fires an explosive rocket when you swing
it through the air.
<!--more-->
In order to make it nice looking, you decide to give it
the shape of a glowing arrow.</p>

<p>I’ve already prepared such an item. Here is a picture of it:</p>

<p><img src="/images/magic-wand-rocket-arrow-in-frame.jpg" alt="The Rocket-Firing Magic Wand" /></p>

<p>Here is, how you can create this nice little rocket thrower:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">/</span><span class="n">lua</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Items</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"arrow"</span><span class="p">);</span> <span class="n">i</span><span class="p">:</span><span class="n">putNbt</span><span class="p">({</span><span class="n">tag</span><span class="o">=</span> <span class="p">{</span>
  <span class="n">display</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Name</span> <span class="o">=</span> <span class="s2">"Rocket Thrower"</span><span class="p">,</span>
    <span class="n">Lore</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Lauches an explosive rocket"</span><span class="p">}</span>
  <span class="p">},</span>
  <span class="n">ench</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span><span class="n">id</span><span class="o">=</span><span class="mi">999</span><span class="p">,</span> <span class="n">lvl</span><span class="o">=</span><span class="mi">1</span><span class="p">}</span> <span class="p">}</span>
<span class="p">}});</span>
<span class="n">spell</span><span class="p">.</span><span class="n">owner</span><span class="p">.</span><span class="n">mainhand</span><span class="o">=</span><span class="n">i</span>
</code></pre></div></div>

<p>Now we want to add some behaviour to this item.
For that we need to create two separate functions:
one for making the rocket fly, and the other for launching it
when you swing your arm.</p>

<p>Since we need to create two functions, please make sure that you are familiar with
<a href="/tutorials/importing_lua_files">importing Lua files</a> into your spells.</p>

<h2 id="how-to-create-a-profile">How to Create a Profile</h2>

<p>To ensure that you can use the new functions from the command line, you just need
to put them into your personal profile.
A profile is a special file that will be automatically imported when you cast a spell
from the command line.</p>

<p>If you haven’t created a profile already, the following steps show  how you can do it.
First, authenticate your browser by typing:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/wol browser login
</code></pre></div></div>
<p>and then click on the new link that appears in the chat (you must press ‘T’ before you can click on the link).</p>

<p>Then create the profile with the built-in editor by typing:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/wol file edit profile.lua
</code></pre></div></div>
<p>and again click on the new link.</p>

<p>Now you can copy and paste the source code of the two functions shown below into the new file and save it using CRTL-S.</p>

<p>First, let’s have a look at the function that can create a flying rocket.</p>
<h2 id="how-to-create-a-rocket">How To Create a Rocket</h2>

<p>This can be done in a lot of different ways.
We just choose a simple one that creates a beam of smoke until it hits
some block. Then it explodes by spawning some primed tnt.</p>

<p><a name="rocket" style="position:relative; top:-70px; display:block;"></a>
Here is the code:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="nf">rocket</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
  <span class="n">player</span>         <span class="o">=</span> <span class="n">player</span> <span class="ow">or</span> <span class="n">spell</span><span class="p">.</span><span class="n">owner</span>
  <span class="n">spell</span><span class="p">.</span><span class="n">pos</span>      <span class="o">=</span> <span class="n">player</span><span class="p">.</span><span class="n">pos</span> <span class="o">+</span> <span class="n">Vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">player</span><span class="p">.</span><span class="n">eyeHeight</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                              <span class="o">+</span> <span class="n">player</span><span class="p">.</span><span class="n">lookVec</span><span class="o">*</span><span class="mi">1</span><span class="p">.</span><span class="mi">5</span>
  <span class="kd">local</span> <span class="n">velocity</span> <span class="o">=</span> <span class="n">player</span><span class="p">.</span><span class="n">lookVec</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span>
  <span class="n">spell</span><span class="p">:</span><span class="n">execute</span><span class="p">(</span><span class="s2">"/playsound entity.firework.shoot master @a ~ ~ ~ 0.5"</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span> <span class="k">do</span>
    <span class="n">spell</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">spell</span><span class="p">.</span><span class="n">pos</span><span class="o">+</span><span class="n">velocity</span>
    <span class="n">spell</span><span class="p">:</span><span class="n">execute</span><span class="p">(</span><span class="s2">"particle smoke ~ ~ ~ 0 0 0 0 2 force"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spell</span><span class="p">.</span><span class="n">block</span><span class="p">.</span><span class="n">material</span><span class="p">.</span><span class="n">solid</span> <span class="k">then</span>
      <span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span> <span class="k">do</span>
        <span class="n">spell</span><span class="p">:</span><span class="n">execute</span><span class="p">(</span><span class="s2">"/summon tnt ~ ~ ~ {Primed:1}"</span><span class="p">)</span>
      <span class="k">end</span>
      <span class="k">return</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">20</span><span class="o">==</span><span class="mi">0</span> <span class="k">then</span>
      <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">100</span><span class="o">==</span><span class="mi">0</span> <span class="k">then</span>
      <span class="n">spell</span><span class="p">:</span><span class="n">execute</span><span class="p">(</span><span class="s2">"/playsound entity.generic.burn master @a ~ ~ ~ 2"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>
<p>When you have added this function to your profile (and saved it), you
can experiment with it from the command line.</p>

<p>Just find some place with a good view onto something you want to blow up.
Make sure to look at it directly.
Then cast the following spell:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">/</span><span class="n">lua</span> <span class="n">rocket</span><span class="p">()</span>
</code></pre></div></div>
<p>This should fire a rocket.
So far, so good.</p>

<h2 id="how-to-bind-a-spell-to-an-event">How To Bind a Spell to an Event</h2>
<p>Now we want to bind this spell to the <a href="/versions/current/modules/SwingArmEvent">SwingArmEvent</a>.</p>

<p>To do this, we need some spell that observes this kind of event.
Whenever it occurs, a rocket should be fired.</p>

<p>Here is the function for this:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="nf">rocketThrowerObserver</span><span class="p">()</span>
  <span class="n">spell</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"rocket-thrower-observer"</span>
  <span class="kd">local</span> <span class="n">q</span> <span class="o">=</span> <span class="n">Events</span><span class="p">.</span><span class="n">collect</span><span class="p">(</span><span class="s2">"SwingArmEvent"</span><span class="p">)</span>
  <span class="k">while</span> <span class="kc">true</span> <span class="k">do</span>
    <span class="kd">local</span> <span class="n">e</span> <span class="o">=</span> <span class="n">q</span><span class="p">:</span><span class="nb">next</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="n">item</span><span class="p">.</span><span class="n">displayName</span> <span class="o">==</span> <span class="s2">"Rocket Thrower"</span> <span class="k">then</span>
      <span class="kd">local</span> <span class="n">cmd</span> <span class="o">=</span> <span class="s2">"/lua p=Entities.find('@p[name=%s]')[1]; rocket(p)"</span>
      <span class="n">spell</span><span class="p">:</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>
<p>Make sure to add it to your profile, and then call:</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">/</span><span class="n">lua</span> <span class="n">rocketThrowerObserver</span><span class="p">()</span>
</code></pre></div></div>

<p>If you want to stop this spell any time later, just type:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/wol spell break byName rocket-thrower-observer
</code></pre></div></div>
<p>This will break all spells with the specified name.</p>

<p>This is handy when you want to cast an updated version of this spell and you
want to make sure that not two versions of this spell are running at the same time.</p>

<p>Here is a video of the rocket thrower in action:</p>
<style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style>

<div class="embed-container"><iframe src="https://www.youtube.com/embed/p7r68hYR264" frameborder="0" allowfullscreen=""></iframe></div>
<p><br /></p>


        <div id="naviLeft">
<h2>Examples</h2>
<ul>

  <li>
    <a href="/examples/how-to-create-a-multicolor-floor-of-wool/">How to Create a Multicolored Floor of Wool</a>
  </li>

  <li>
    <a href="/examples/random-walk/">Random Walking Grass</a>
  </li>

  <li>
    <a href="/examples/the-army-of-zombies/">The Army of Zombies</a>
  </li>

  <li>
    <a href="/examples/the-door/">The Door</a>
  </li>

  <li>
    <a href="/examples/vertical-rails/">The Vertical Rails Spell</a>
  </li>

  <li>
    <a href="/examples/rocket-thrower/">The Rocket Thrower</a>
  </li>

<li><a href="/examples.html">See All Examples...</a></li>
</ul>
</div>


        <div id="naviRight">
<h2>Navigation</h2>
<ul>
   
      <li><a href="/" alt="Home">Home</a></li>
   
      <li><a href="/news" alt="News">News</a></li>
   
      <li><a href="/features" alt="Features">Features</a></li>
   
      <li><a href="/introduction" alt="Introduction">Introduction</a></li>
   
      <li><a href="/installation" alt="Download & Installation">Download & Installation</a></li>
   
      <li><a href="/versions/current/configuration-file" alt="Configuration">Configuration</a></li>
   
      <li><a href="/versions/current/lua-command" alt="The /lua Command">The /lua Command</a></li>
   
      <li><a href="/versions/current/wol-command" alt="The /wol Command">The /wol Command</a></li>
   
      <li><a href="/versions/current/spellbooklibrary" alt="Spell Book Library">Spell Book Library</a></li>
   
      <li><a href="/spellpacks" alt="Spell Packs">Spell Packs</a></li>
   
      <li><a href="/examples" alt="Examples">Examples</a></li>
   
      <li><a href="/tutorials" alt="Tutorials">Tutorials</a></li>
   
      <li><a href="/feedback" alt="Feedback">Feedback</a></li>
   
</ul>
</div>

      </section>

    </div>


    
  </body>
</html>
